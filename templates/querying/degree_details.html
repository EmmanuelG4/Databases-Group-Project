{% extends "layout.html" %}

{% block title %}Degree: Courses & Objectives{% endblock %}

{% block content %}
<div class="container">
    <h2>Degree: Courses, Objectives, and Associations</h2>

    <p>
        Use this page to pick a degree and see:
    </p>
    <ul>
        <li>All courses that belong to that degree (with a flag for core courses).</li>
        <li>All learning objectives linked to that degree.</li>
        <li>Which courses are connected to which objectives.</li>
    </ul>

    <!-- Degree selection form -->
    <form method="POST" action="{{ url_for('querying.query_degree_details') }}" class="degree-form">
        <div class="form-group">
            <label for="degree_select">Select Degree (Required):</label>
            <select id="degree_select" name="degree_select" required>
                <option value="">-- Select Degree --</option>
                {% for degree in degrees %}
                <option value="{{ degree.degree_name }}|{{ degree.degree_level }}"
                    {% if results and results.degree_name == degree.degree_name and results.degree_level == degree.degree_level %}
                        selected
                    {% endif %}>
                    {{ degree.degree_name }} ({{ degree.degree_level }})
                </option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Show Degree Details</button>
    </form>

    {% if results %}
        <hr>

        <h3>Selected Degree</h3>
        <p>
            <strong>Degree:</strong> {{ results.degree_name }} ({{ results.degree_level }})
        </p>

        <div class="degree-details-layout">
            <!-- Courses table -->
            <section class="card">
                <h3>Courses for This Degree</h3>
                {% if results.courses %}
                    <p>
                        Courses that are marked as <strong>core</strong> are usually the main required classes
                        for the degree. Other courses may be supporting or elective.
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Course Number</th>
                                <th>Course Name</th>
                                <th>Core?</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for c in results.courses %}
                            <tr>
                                <td>{{ c.course_num }}</td>
                                <td>{{ c.course_name }}</td>
                                <td>
                                    {% if c.core %}
                                        Yes
                                    {% else %}
                                        No
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No courses are linked to this degree yet.</p>
                {% endif %}
            </section>

            <!-- Objectives + Associations -->
            <section class="card">
                <h3>Learning Objectives & Course Links</h3>
                {% if results.objectives %}
                    <p>
                        Each learning objective can be connected to one or more courses
                        (core or non-core). This helps track where students are actually
                        being assessed on that objective.
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Objective Code</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Courses Linked to This Objective</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for obj in results.objectives %}
                            <tr>
                                <td>{{ obj.obj_code }}</td>
                                <td>{{ obj.title }}</td>
                                <td>{{ obj.description }}</td>
                                <td>
                                    {% set has_link = false %}
                                    <ul class="course-links-list">
                                        {% for link in results.associated_links %}
                                            {% if link.obj_code == obj.obj_code %}
                                                {% set has_link = true %}
                                                <li>{{ link.course_num }}</li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                    {% if not has_link %}
                                        <em>No courses linked yet.</em>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No learning objectives are linked to this degree yet.</p>
                {% endif %}
            </section>
        </div>
    {% endif %}
</div>

<style>
    .degree-form {
        margin-top: 15px;
        margin-bottom: 20px;
    }

    .degree-details-layout {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 20px;
    }

    .card {
        flex: 1 1 320px;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 16px;
        background-color: #ffffff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .card h3 {
        margin-top: 0;
        border-bottom: 2px solid #5cb85c;
        padding-bottom: 6px;
        margin-bottom: 10px;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.95em;
    }

    .table thead {
        background-color: #f5f5f5;
    }

    .table th,
    .table td {
        border: 1px solid #ddd;
        padding: 6px 8px;
        vertical-align: top;
    }

    .course-links-list {
        margin: 0;
        padding-left: 18px;
    }
</style>
{% endblock %}
